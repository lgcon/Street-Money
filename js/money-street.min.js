!function(){function a(a,b){if(A.time.elapsedSince(a.lastTheft)>200&&A.score>0){A.score--,a.game.playsound("thief_sound"),a.lastTheft=A.time.time,A.coinsleftText.count.setText(A.level.goal-A.score);var c=A.add.text(a.x,a.top-100,"-1",{font:A.game.textFont,fill:"#FF0000",fontSize:50});A.add.tween(c).from({y:a.y,alpha:0},1e3,Phaser.Easing.Linear.None,!0).onComplete.add(c.destroy,c)}}function b(){for(var a=0;a<this.children.length;a++)A.path.updateDirection(this.children[a])}function c(){for(var a=0;a<A.treasures.length;a++){var b=A.treasures.children[a];if(A.physics.arcade.distanceBetween(A.player,b)<50)if(b.data.life--,D.playsound("hit_sound"),b.data.life>0){var c=A.add.text(b.x,b.top-120,b.data.life,{font:this.game.textFont,fill:"#FF8000",fontSize:50});A.add.tween(c).from({y:b.top,alpha:0},500,Phaser.Easing.Linear.None,!0).onComplete.add(c.destroy,c)}else A.treasures.breack(b)}}function d(a){this.game.playsound("break_sound");for(var b=new Phaser.Point(500,0),c=2*Math.PI/a.data.coins,d=0;d<a.data.coins;d++){var e=A.coins.create(a.x,a.y,"coin",0);e.body.velocity.setTo(b.x,b.y),e.body.collideWorldBounds=!0,e.anchor.setTo(.5,1),e.body.setSize(e.width/2,B),A.keepInTheStreet.push(e),A.add.tween(e.body.velocity).to({x:0,y:0},1e3,Phaser.Easing.Linear.None,!0),e.animations.add("spin",[0,1,2,3,4,5,6,7],10,!0),e.animations.play("spin"),b.rotate(0,0,c)}a.destroy()}function e(){for(var a=0;a<A.level.bonuses.speed.length;a++)if(A.level.bonuses.speed[a].time===A.level.time-A.timer.left){var b=A.boots.create(A.level.bonuses.speed[a].x,A.level.bonuses.speed[a].y,"boots");b.body.setSize(b.width/2,B,b.width/4,b.height-B)}}function f(a,b){b.destroy(),A.add.tween(a).from({speed:2*a.speed},4e3,"Linear",!0)}function g(a,b){b.destroy(),A.score++;var c=A.level.goal-A.score;if(A.coinsleftText.count.setText(A.level.goal-A.score),a.game.playsound("coin_sound"),A.currentCoin<A.level.coins.length){var d=A.coins.create(A.level.coins[A.currentCoin].x,A.level.coins[A.currentCoin].y,"coin");d.animations.add("spin",[0,1,2,3,4,5,6,7],10,!0),d.animations.play("spin"),d.body.setSize(d.width/2,B,d.width/4,d.height-B),A.currentCoin++}0>=c&&A.levelpassed()}function h(a,b){a.allowTeleport&&(a.animation="fall",a.isTeleporting?a.body.velocity.setTo(0,0):(a.isTeleporting=!0,A.timer.add(500,this.go,this,a,b),a.game.playsound("drain_sound")))}function j(a,b){var c=A.drains.children[b.go];A.camera.unfollow(),A.player.exists=!1,a.position.setTo(c.body.center.x,c.body.center.y),A.add.tween(A.camera.view).to({x:a.position.x-A.camera.view.halfWidth,y:a.position.y-A.camera.view.halfHeight},500).start().onComplete.add(function(){A.camera.follow(a),A.player.exists=!0},A),a.allowTeleport=!1,a.isTeleporting=!1}function k(a,b){a.allowSlip&&(a.allowSlip=!1,a.game.playsound("oil_sound"),console.log(a.body.velocity.x),a.body.facing==Phaser.UP||a.body.facing==Phaser.DOWN?A.add.tween(a.body.velocity).to({y:0},1500,"Linear",!0):A.add.tween(a.body.velocity).to({x:0},1500,"Linear",!0))}function l(){A.joystick.resetFrames(),A.joystick.down.isDown?(A.joystick.down.frame=1,this.body.velocity.setTo(0,this.speed),this.animation="down"):A.joystick.left.isDown?(A.joystick.left.frame=1,this.body.velocity.setTo(-this.speed,0),this.animation="left"):A.joystick.right.isDown?(A.joystick.right.frame=1,this.body.velocity.setTo(this.speed,0),this.animation="right"):A.joystick.up.isDown?(A.joystick.up.frame=1,this.body.velocity.setTo(0,-this.speed),this.animation="up"):(this.body.velocity.setTo(0,0),this.animation=null)}function m(){v.down.isDown?(this.body.velocity.setTo(0,this.speed),this.animation="down"):v.left.isDown?(this.body.velocity.setTo(-this.speed,0),this.animation="left"):v.right.isDown?(this.body.velocity.setTo(this.speed,0),this.animation="right"):v.up.isDown?(this.body.velocity.setTo(0,-this.speed),this.animation="up"):(this.body.velocity.setTo(0,0),this.animation=null)}function n(){this.animation?this.animations.play(this.animation):this.animations.stop()}function o(){D.input.activePointer.isDown&&(this.isDown=!0)}function p(){for(button in this)this[button].frame=0}function q(a){this.label.text.text=a,this.label.width=this.label.text.width+50}function r(){this.left--,0===this.left?(this.remove(this.timeLeftEvent),A.gameover()):this.left<=10&&(this.game.playsound("beep_sound"),this.text.addColor("#FF0000",0),this.text.count.addColor("#FF0000",0)),A.timer.text.count.setText(this.left),A.boots.generate()}function s(a){if(a instanceof Phaser.Group)for(var b=0;b<a.length;b++)s(a.children[b]);else a.anchor.setTo(.5,1),a.body.setSize(a.width/2,B)}function t(a){switch(a){case C.up:return"up";case C.down:return"down";case C.right:return"right";case C.left:return"left"}}function u(a){var b=Math.PI/4;return-b>a&&a>3*-b?C.up:a>b&&3*b>a?C.down:a>-b&&b>a?C.right:C.left}Phaser.Group.prototype.drawCache=[],Phaser.Group.prototype.renderDrawCache=!1,Phaser.Group.prototype._recursiveCache=function(a){for(var b=0;b<a.length;b++)a[b]instanceof Phaser.Group?this._recursiveCache(a[b].children):this.drawCache.push(a[b])},Phaser.Group.prototype.updateDrawCache=function(){this.drawCache.length=0,this._recursiveCache(this.children)},Phaser.Group.prototype._renderWebGL=function(a){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);var b,c;if(c=this.renderDrawCache?this.drawCache:this.children,this._mask||this._filters){for(this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),b=0;b<c.length;b++)c[b]._renderWebGL(a);a.spriteBatch.stop(),this._filters&&a.filterManager.popFilter(),this._mask&&a.maskManager.popMask(a),a.spriteBatch.start()}else for(b=0;b<c.length;b++)c[b]._renderWebGL(a)}},Phaser.Group.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);this._mask&&a.maskManager.pushMask(this._mask,a);var b;b=this.renderDrawCache?this.drawCache:this.children;for(var c=0;c<b.length;c++)b[c]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}},Phaser.Group.prototype.sort=function(a,b,c){if(!(this.children.length<2)){"undefined"==typeof a&&(a="z"),"undefined"==typeof b&&(b=Phaser.Group.SORT_ASCENDING),this._sortProperty=a;var d;c?(this.updateDrawCache(),this.renderDrawCache=!0,d=this.drawCache):(this.renderDrawCache&&(this.renderDrawCache=!1),d=this.children),b===Phaser.Group.SORT_ASCENDING?d.sort(this.ascendingSortHandler.bind(this)):d.sort(this.descendingSortHandler.bind(this)),this.updateZ()}};var v,w={init:function(){this.scale.scaleMode=Phaser.ScaleManager.USER_SCALE,this.scale.setMinMax(200,100,1200,750),this.scale.pageAlignHorizontally=!0,this.scale.setResizeCallback(this.onResizeCallback,this),this.game.device.desktop||(this.scale.forceOrientation(!0,!1),this.scale.enterIncorrectOrientation.add(this.enterIncorrectOrientation,this),this.scale.leaveIncorrectOrientation.add(this.leaveIncorrectOrientation,this))},onResizeCallback:function(){var a=Math.min(window.innerWidth/this.game.width,window.innerHeight/this.game.height);this.scale.setUserScale(a,a,0,0)},enterIncorrectOrientation:function(){document.getElementById("orientation").style.display="block",document.getElementById("game").style.display="none",this.game.paused=!0},leaveIncorrectOrientation:function(){document.getElementById("orientation").style.display="none",document.getElementById("game").style.display="block",this.game.paused=!1},preload:function(){this.load.text("conf","./config.json"),this.load.image("preloadbar","assets/images/preloader-bar.png"),this.load.image("rotatescreen","assets/images/rotatescreen.png"),this.physics.startSystem(Phaser.Physics.ARCADE),this.game.soundOn=!0},create:function(){D.conf=JSON.parse(this.game.cache.getText("conf")),D.textFont=D.conf.font.name,D.lastPassed=1,D.current_lev=D.lastPassed,WebFont.load({google:{families:[D.conf.font.family]},active:function(){D.state.start("Load")}})}},x={preload:function(){this.preloadBar=this.add.image(180,this.world.centerY,"preloadbar"),this.preloadBar.scale.setTo(17,7),this.load.setPreloadSprite(this.preloadBar);var a={font:D.textFont,fill:"#FBEFEF",fontSize:100};this.add.text(this.world.centerX,this.preloadBar.y-80,"Loading...",a).anchor.setTo(.5,.5),this.load.image("menu_title","assets/images/menu_title.png"),this.load.image("arrow_left","assets/images/arrow_left.png"),this.load.image("arrow_right","assets/images/arrow_right.png"),this.load.image("lock","assets/images/lock.png"),this.load.text("language","assets/languages/"+D.conf.lang+".json"),this.load.image("panel","assets/images/panel.png"),this.load.image("level_label","assets/images/level_label.png"),this.load.spritesheet("play_button","assets/images/button.png",195,75),this.load.spritesheet("speaker","assets/images/speaker.png",48,48),this.load.image("pause_button","assets/images/pause_button.png"),this.load.spritesheet("star","assets/images/star.png",95,97),this.load.spritesheet("player","assets/images/player.png",64,96),this.load.image("city","assets/images/city.png"),this.load.spritesheet("joystick","assets/images/joystick.png",180,144),this.load.image("hitButton","assets/images/hitButton.png"),this.load.spritesheet("coin","assets/images/coin_gold.png",64,64),this.load.image("boots","assets/images/boots.png"),this.load.image("oil","assets/images/oil_spot.png"),this.load.image("drain","assets/images/drain.png"),this.load.spritesheet("robber","assets/images/robber.png",64,96),this.load.spritesheet("treasure","assets/images/treasure.png",64,96);for(var b=1;b<D.conf.total_levels+1;b++)this.load.text("level"+b,"assets/levels/level"+b+".json");this.load.audio("click_sound",["assets/sounds/click.ogg","assets/sounds/click.wma","assets/sounds/click.mp3"]),this.load.audio("music",["assets/sounds/music.ogg","assets/sounds/music.wma","assets/sounds/music.mp3"],!0),this.load.audio("coin_sound",["assets/sounds/coin.ogg","assets/sounds/coin.wma","assets/sounds/coin.mp3"]),this.load.audio("thief_sound",["assets/sounds/thief.ogg","assets/sounds/thief.wma","assets/sounds/thief.mp3"]),this.load.audio("hit_sound",["assets/sounds/hit.ogg","assets/sounds/hit.wma","assets/sounds/hit.mp3"]),this.load.audio("break_sound",["assets/sounds/break.ogg","assets/sounds/break.wma","assets/sounds/break.mp3"]),this.load.audio("drain_sound",["assets/sounds/drain.ogg","assets/sounds/drain.wma","assets/sounds/drain.mp3"]),this.load.audio("oil_sound",["assets/sounds/oil.ogg","assets/sounds/oil.wma","assets/sounds/oil.mp3"]),this.load.audio("win_sound",["assets/sounds/win.ogg","assets/sounds/win.wma","assets/sounds/win.mp3"]),this.load.audio("gameover_sound",["assets/sounds/gameover.ogg","assets/sounds/gameover.wma","assets/sounds/gameover.mp3"]),this.load.audio("bad_sound",["assets/sounds/bad.ogg","assets/sounds/bad.wma","assets/sounds/bad.mp3"]),this.load.audio("beep_sound",["assets/sounds/beep.ogg","assets/sounds/beep.wma","assets/sounds/beep.mp3"]),this.load.onLoadComplete.add(function(){this.game.music=this.add.audio("music",1,!0),this.game.music.play(),this.game.state.start("Menu")},this)}},y={init:function(){this.world.width=this.game.width},preload:function(){this.game.lang=JSON.parse(this.game.cache.getText("language"))},create:function(){this.game.background?(this.add.existing(this.game.background),this.game.background.width=this.world.width):(this.game.background=this.add.tileSprite(0,0,this.world.width,this.world.height,"city"),this.game.background.alpha=.5);var a=this.world.centerX,b=this.world.centerY;this.add.image(a,100,"menu_title").anchor.setTo(.5,.5),this.textLevel=this.add.text(a,b+20,D.current_lev,{font:D.textFont,fill:"#FBEFEF",fontSize:100}),this.textLevel.anchor.setTo(.5,.5),this.add.text(a,this.textLevel.y-120,D.lang.level_selector,{font:D.textFont,fill:"#FBEFEF",fontSize:60}).anchor.setTo(.5,.5),this.lock=this.add.image(this.textLevel.x,this.textLevel.y,"lock"),this.lock.anchor.setTo(.5,.5),this.lock.visible=!1;var c=100;this.arrowLeft=this.add.image(a-c,this.textLevel.y,"arrow_left"),this.arrowLeft.anchor.setTo(.5,.5),this.arrowLeft.inputEnabled=!0,this.arrowLeft.events.onInputDown.add(function(){this.updateLevel(-1)},this),this.arrowRight=this.add.image(a+c,this.textLevel.y,"arrow_right"),this.arrowRight.anchor.setTo(.5,.5),this.arrowRight.inputEnabled=!0,this.arrowRight.events.onInputDown.add(function(){this.updateLevel(1)},this),this.playButton=this.add.button(a,b+180,"play_button"),this.playButton.anchor.setTo(.5,.5),this.playButton.text=this.add.text(this.playButton.x,this.playButton.y,D.lang.play_button,{font:D.textFont,fill:"#FBEFEF",fontSize:40}),this.playButton.text.anchor.setTo(.5,.5),this.playButton.onInputDown.add(function(){this.textLevel.locked?this.playButton.goDown("bad_sound"):this.playButton.goDown("click_sound")},this),this.playButton.onInputUp.add(function(){this.playButton.goUp(),this.textLevel.locked||this.state.start("Play-intro")},this),this.game.speaker?(this.add.existing(this.game.speaker),this.game.speaker.x=this.game.conf.positions.speaker.x):(this.game.speaker=this.add.image(this.game.conf.positions.speaker.x,this.game.conf.positions.speaker.y,"speaker",0),this.game.speaker.scale.setTo(1.5,1.5),this.game.speaker.fixedToCamera=!0,this.game.speaker.inputEnabled=!0,this.game.speaker.events.onInputDown.add(this.switchSound,this)),this.scale.fullScreenScaleMode=Phaser.ScaleManager.EXACT_FIT,this.input.onDown.add(this.goFullscreen,this)},shutdown:function(){this.world.remove(this.game.speaker),this.world.remove(this.game.background)},updateLevel:function(a){var b=D.current_lev+a;return 1>b||b>D.conf.total_levels?void this.game.playsound("bad_sound"):(D.current_lev=b,this.game.playsound("click_sound"),b>D.lastPassed?this.textLevel.locked||(this.textLevel.fill="#BDBDBD",this.textLevel.alpha=.3,this.lock.visible=!0,this.textLevel.locked=!0):this.textLevel.locked&&(this.textLevel.fill="#FBEFEF",this.textLevel.alpha=1,this.lock.visible=!1,this.textLevel.locked=!1),void this.textLevel.setText(D.current_lev))},switchSound:function(){this.sound.play("click_sound"),0==this.game.speaker.frame?(this.game.speaker.frame=1,this.game.speaker.alpha=.7,this.game.soundOn=!1,this.game.music.stop()):(this.game.speaker.frame=0,this.game.speaker.alpha=1,this.game.soundOn=!0,this.game.music.play())},goFullscreen:function(){this.scale.startFullScreen()}},z={init:function(){this.world.width=this.game.width,A.level=JSON.parse(this.game.cache.getText("level"+this.game.current_lev))},create:function(){this.add.existing(this.game.background),this.add.existing(this.game.speaker),this.game.speaker.x=this.game.conf.positions.speaker.x,this.board=this.game.createBoard(this.world.centerX,this.world.centerY),this.board.visible=!0,this.board.fixedToCamera=!1,this.board.label.y+=40,this.board.label.text.y+=40,this.style={font:this.game.textFont,fill:"#FBEFEF",fontSize:60},this.board.setTitle(this.game.lang.level+" "+this.game.current_lev),this.board.button=this.add.button(this.board.panel.x,this.board.panel.y+250,"play_button"),this.board.button.anchor.setTo(.5),this.board.button.onInputDown.add(function(){this.board.button.goDown("click_sound")},this),this.board.add(this.board.button),A.level.tuto&&this.game.lang.tutos[this.game.current_lev]?this.showTuto():this.showInfos()},shutdown:function(){this.world.remove(this.game.speaker),this.world.remove(this.game.background)},showTuto:function(){this.hasTuto=!0;var a=this.game.lang.tutos[this.game.current_lev];this.tutoTitle=this.add.text(this.board.label.x,this.board.label.y+100,a.title,{font:this.game.textFont,fill:"#FBEFEF",fontSize:60}),this.tutoImg=this.add.image(this.board.panel.x,this.tutoTitle.y+80,A.level.tuto.image,A.level.tuto.frame),this.tutoTxt=this.add.text(this.board.panel.x,this.tutoImg.y+60,a.text,this.style),this.board.button.text=this.add.text(this.board.button.x,this.board.button.y,this.game.lang.tutos.button,{font:this.game.textFont,fill:"#FBEFEF",fontSize:40}),this.board.button.text.anchor.setTo(.5,.5),this.tutoElements=this.add.group(),this.tutoElements.addMultiple([this.tutoTitle,this.tutoImg,this.tutoTxt,this.board.button.text]),this.tutoElements.setAll("anchor.x",.5),this.board.add(this.tutoElements),this.add.tween(this.board).from({y:-720},300,"Linear").start(),this.board.button.onInputUp.add(function(){this.board.button.goUp(),this.showInfos()},this)},showInfos:function(){this.hasTuto&&this.tutoElements.destroy(),this.infos=this.add.text(this.board.panel.x,this.board.panel.y-80,this.game.lang.text_goal+" "+A.level.goal+"\n"+this.game.lang.text_time+" "+A.level.time+"s",this.style),this.infos.anchor.setTo(.5),this.text_preLevel=this.add.text(this.board.panel.x,this.board.panel.y+100,this.game.lang.text_preLevel,this.style),this.text_preLevel.anchor.setTo(.5),this.board.button.text=this.add.text(this.board.button.x,this.board.button.y,this.game.lang.start_button,{font:this.game.textFont,fill:"#FBEFEF",fontSize:40}),this.board.button.onInputUp.add(function(){this.state.start("Play")},this),this.board.button.text.anchor.setTo(.5,.5),this.board.addMultiple([this.infos,this.text_preLevel,this.board.button.text]),this.hasTuto||this.add.tween(this.board).from({y:-720},300,"Linear").start()}},A={preload:function(){this.world.setBounds(0,0,this.level.width,750),this.keepInTheStreet=[]},create:function(){this.add.existing(this.game.background),this.game.background.width=this.world.width,this.game.background.alpha=1,this.player=this.createPlayer(),this.coins=this.createCoins(),this.robbers=this.createRobbers(),this.treasures=this.createTreasures(),this.drains=this.createDrains(),this.oilSpots=this.createOilSpots(),this.boots=this.createBoots();var a=[this.robbers,this.treasures];this.path.setProperties(a);var b=[this.robbers,this.treasures];for(h=0;h<b.length;h++)b[h].callAll("animations.add","animations","down",[0,1,2,3],10,!0),b[h].callAll("animations.add","animations","left",[4,5,6,7],10,!0),b[h].callAll("animations.add","animations","right",[8,9,10,11],10,!0),b[h].callAll("animations.add","animations","up",[12,13,14,15],10,!0);var c=this.game.width/2,d={font:this.game.textFont,fill:"#FBEFEF",fontSize:60};this.score=0;var e=this.game.conf.positions.text_score;this.coinsleftText=this.add.text(e.x,e.y,this.game.lang.text_score,d),this.coinsleftText.count=this.add.text(this.coinsleftText.right+20,this.coinsleftText.y,A.level.goal,d),this.coinsleftText.fixedToCamera=!0,this.coinsleftText.count.fixedToCamera=!0,this.timer=this.createTimer(),this.timer.start();var f=this.game.conf.positions.text_timeleft;this.timer.text=this.add.text(f.x,f.y,this.game.lang.text_timer,d),this.timer.text.count=this.add.text(this.timer.text.right+20,this.timer.text.y,this.timer.left,d),this.timer.text.fixedToCamera=!0,this.timer.text.count.fixedToCamera=!0,this.camera.follow(this.player),this.game.device.desktop?(v=this.input.keyboard.createCursorKeys(),this.spacebar=this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.spacebar.onDown.add(this.treasures.hit),this.buttonsToPause=[]):(this.hitButton=this.createHitButton(this.game.conf.positions.hitButton.x,this.game.conf.positions.hitButton.y),this.joystick=this.createJoystick(this.game.conf.positions.joystick.x,this.game.conf.positions.joystick.y,this.game.conf.positions.joystick.radius),this.buttonsToPause=[this.joystick.up,this.joystick.down,this.joystick.right,this.joystick.left,this.hitButton]),this.add.existing(this.game.speaker),this.pauseButton=this.add.button(this.game.speaker.x-100,this.game.speaker.y,"pause_button"),this.pauseButton.scale.setTo(1.5,1.5),this.pauseButton.fixedToCamera=!0,this.pauseButton.onInputDown.add(this.startPause,this),this.buttonsToPause.push(this.pauseButton),this.board=this.game.createBoard(c,400,450,450);var g={font:this.game.textFont,fill:"#FBEFEF",fontSize:30};this.restartButton=this.make.button(this.board.panel.x,this.board.panel.y-80,"play_button"),this.restartButton.onInputDown.add(function(){this.restartButton.goDown("click_sound")},this),this.restartButton.onInputUp.add(function(){this.restartButton.goUp(),this.game.state.start("Play-intro")},this),this.restartButton.text=this.make.text(0,0,this.game.lang.restart_button,g),this.restartButton.addChild(this.restartButton.text),this.menuButton=this.make.button(this.board.panel.x,this.board.panel.y+20,"play_button"),this.menuButton.onInputDown.add(function(){this.menuButton.goDown("click_sound")},this),this.menuButton.onInputUp.add(function(){this.menuButton.goUp(),this.game.state.start("Menu")},this),this.menuButton.text=this.make.text(0,0,this.game.lang.menu_button,g),this.menuButton.addChild(this.menuButton.text),this.resumeButton=this.make.button(this.board.panel.x,this.board.panel.y+120,"play_button"),this.resumeButton.onInputDown.add(function(){this.resumeButton.goDown("click_sound")},this),this.resumeButton.onInputUp.add(function(){this.resumeButton.goUp(),this.stopPause()},this),this.resumeButton.text=this.make.text(0,0,this.game.lang.resume_button,g),this.resumeButton.addChild(this.resumeButton.text),this.nextlevelButton=this.make.button(c+150,500,"play_button"),this.nextlevelButton.onInputDown.add(function(){this.game.current_lev>=this.game.conf.total_levels?this.nextlevelButton.goDown("bad_sound"):this.nextlevelButton.goDown("click_sound")},this),this.nextlevelButton.onInputUp.add(function(){this.nextlevelButton.goUp(),this.startNextLevel()},this),this.nextlevelButton.text=this.make.text(0,0,this.game.lang.goNextLevel_button,g),this.nextlevelButton.addChild(this.nextlevelButton.text),this.board.buttons.addMultiple([this.restartButton,this.menuButton,this.resumeButton,this.nextlevelButton]),this.board.buttons.setAllChildren("visible",!1);for(var h=0;h<this.board.buttons.length;h++)this.board.buttons.children[h].anchor.setTo(.5),this.board.buttons.children[h].text.anchor.setTo(.5);this.board.buttons.fixedToCamera=!0,this.pauseMenu=[this.restartButton,this.menuButton,this.resumeButton],this.gameoverMenu=[this.restartButton,this.menuButton],this.levelpassedMenu=[this.restartButton,this.nextlevelButton],this.groundObjects=this.add.group(),this.groundObjects.addMultiple([this.oilSpots,this.drains]),this.entitiesToSort=this.add.group(),this.entitiesToSort.addMultiple([this.player,this.robbers,this.treasures,this.boots,this.coins]),s(this.entitiesToSort);var i;for(h=0;h<this.drains.length;h++)i=this.drains.children[h],i.body.setSize(10,10,i.width/2-5,i.height/2-5);for(h=0;h<this.oilSpots.length;h++)i=this.oilSpots.children[h],i.body.setSize(i.width/2,i.height/2,i.width/4,i.height/4);this.elementsToPause=this.world.createSubGroup(),this.world.addMultiple([this.game.speaker,this.board,this.board.buttons])},update:function(){for(this.player.move(),this.keepInTheStreet.forEach(function(a){a.y<505&&(a.y=505)},this),i=0;i<this.treasures.children.length;i++)this.path.updateDirection(this.treasures.children[i]);this.physics.arcade.overlap(this.player,this.coins,this.coins.collect),this.physics.arcade.overlap(this.player,this.boots,this.boots.getBonus),this.physics.arcade.overlap(this.player,this.oilSpots,this.oilSpots.slip)||(this.player.allowSlip=!0),!this.physics.arcade.overlap(this.player,this.drains,this.drains.teleport)&&this.player.exists&&(this.player.allowTeleport=!0),this.physics.arcade.collide(this.player,this.robbers,this.robbers.steal),this.physics.arcade.collide(this.player,this.treasures),this.entitiesToSort.sort("bottom",Phaser.Group.SORT_ASCENDING,!0)},render:function(){this.time.advancedTiming=!0,this.game.debug.text("fps: "+this.time.fps,200,32)},shutdown:function(){this.world.remove(this.game.speaker),this.elementsToPause.removeChild(this.game.background),this.game.background.alpha=.5,this.game.background.tint=16777215,this.input.keyboard.enabled||(this.input.keyboard.enabled=!0)},startPause:function(){this.game.playsound("click_sound"),this.board.visible=!0;for(var a=0;a<this.pauseMenu.length;a++)this.pauseMenu[a].visible=!0;this.board.setTitle("Pause"),this.pauseGame()},stopPause:function(){this.board.visible=!1;for(var a=0;a<this.pauseMenu.length;a++)this.pauseMenu[a].visible=!1;this.game.unsetPause([this.elementsToPause],[this.timer],this.buttonsToPause,!0),this.elementsToPause.setAllChildren("tint",16777215),this.game.renderType==Phaser.CANVAS&&(this.game.background.alpha=1)},gameover:function(){this.board.panel.height=300,this.board.label.text.fontSize=65,this.board.label.y=this.board.panel.top,this.board.label.text.y=this.board.panel.top,this.board.buttons.cameraOffset.y+=50,this.game.playsound("gameover_sound"),this.board.visible=!0;for(var a=0;a<this.gameoverMenu.length;a++)this.gameoverMenu[a].visible=!0;this.board.setTitle("Game Over"),this.pauseGame()},levelpassed:function(){this.pauseGame(),this.game.lastPassed++,this.game.playsound("win_sound");var a={font:this.game.textFont,fill:"#FBEFEF",fontSize:80},b=this.add.text(this.camera.x+this.game.width/2,200,this.game.lang.levelpassed,a);b.anchor.setTo(.5);var c=this.timer.left/this.level.time;console.log(c);for(var d=[],e=0;3>e;e++)d.push(this.add.image(b.x-150+150*e,b.y+120,"star",0)),d[e].anchor.setTo(.5);.3>=c&&(d[2].frame=1,.2>=c&&(d[1].frame=1));for(var e=0;e<this.levelpassedMenu.length;e++)this.levelpassedMenu[e].visible=!0;this.restartButton.x=this.nextlevelButton.x-300,this.restartButton.y=this.nextlevelButton.y},startNextLevel:function(){this.game.current_lev>=this.game.conf.total_levels||(this.game.current_lev++,this.state.start("Play-intro"))},pauseGame:function(){this.game.setPause([this.elementsToPause],[this.timer],this.buttonsToPause,!0),this.elementsToPause.setAllChildren("tint",1842203),this.game.renderType==Phaser.CANVAS&&(this.game.background.alpha=.2)}};A.path={setProperties:function(a){for(var b=0;b<a.length;b++)a[b].setAll("goingTo",0,!1,!1,0,!0),a[b].setAll("direction",0,!1,!1,0,!0),a[b].setAll("waiting",!1,!1,!1,0,!0)},updateDirection:function(a){A.path.arrived(a,a.data.path[a.goingTo])&&0==a.waiting&&(a.data.path[a.goingTo].wait>0?(a.body.velocity.setTo(0,0),a.waiting=!0,A.timer.add(a.data.path[a.goingTo].wait,this.goNext,A,a),a.animations.stop()):this.goNext(a))},arrived:function(a,b){switch(a.direction){case C.up:return a.y<=b.y;case C.down:return a.y>=b.y;case C.right:return a.x>=b.x;case C.left:return a.x<=b.x}},goNext:function(a){if(!a.body)return!1;a.data.path[a.goingTo+1]?a.goingTo++:a.goingTo=0;var b=A.physics.arcade.moveToXY(a,a.data.path[a.goingTo].x,a.data.path[a.goingTo].y,a.data.speed);a.direction=u(b),a.animations.play(t(a.direction)),a.waiting=!1}},A.createRobbers=function(){var c=this.add.group();c.enableBody=!0;for(var d=0;d<this.level.personages.robbers.length;d++)c.create(this.level.personages.robbers[d].path[0].x,this.level.personages.robbers[d].path[0].y,"robber"),c.children[d].body.immovable=!0,c.children[d].data=this.level.personages.robbers[d];return c.steal=a,c.update=b,c},A.createTreasures=function(){var a=this.add.group();for(a.enableBody=!0,i=0;i<A.level.personages.treasures.length;i++)a.create(A.level.personages.treasures[i].path[0].x,A.level.personages.treasures[i].path[0].y,"treasure"),a.children[i].data=this.level.personages.treasures[i],a.children[i].body.immovable=!0;return a.hit=c,a.breack=d,a},A.createBoots=function(){var a=this.add.group();return a.enableBody=!0,a.generate=e,a.getBonus=f,a},A.createCoins=function(){var a=this.add.group();for(a.enableBody=!0,this.currentCoin=0;this.currentCoin<this.level.startingCoins;this.currentCoin++)a.create(this.level.coins[this.currentCoin].x,this.level.coins[this.currentCoin].y,"coin",0);return a.callAll("animations.add","animations","spin",[0,1,2,3,4,6,7],10,!0),a.callAll("animations.play","animations","spin"),a.collect=g,a},A.createDrains=function(){var a=this.add.group();for(a.enableBody=!0,i=0;i<A.level.bonuses.drains.length;i++)a.create(A.level.bonuses.drains[i].x,A.level.bonuses.drains[i].y,"drain").go=A.level.bonuses.drains[i].go;return a.teleport=h,a.teleport.go=j,a},A.createOilSpots=function(){var a=this.add.group();a.enableBody=!0;for(var b=0;b<A.level.bonuses.oil.length;b++)a.create(this.level.bonuses.oil[b].x,A.level.bonuses.oil[b].y,"oil");return a.slip=k,a},A.createPlayer=function(){var a=this.add.sprite(this.level.playerStarts.x,this.level.playerStarts.y,"player",0);return this.physics.arcade.enable(a),a.animations.add("down",[0,1,2,3],10,!0),a.animations.add("left",[4,5,6,7],10,!0),a.animations.add("right",[8,9,10,11],10,!0),a.animations.add("up",[12,13,14,15],10,!0),a.animations.add("fall",[0,4,8,12],10,!0),a.body.collideWorldBounds=!0,a.speed=200,a.lastTheft=0,this.keepInTheStreet.push(a),a.allowTeleport=!0,a.isTeleporting=!1,a.move=this.game.device.desktop?m:l,a.update=n,a},Phaser.Button.prototype.goDown=function(a){this.frame=1,this.text.y+=3,this.game.soundOn&&a&&this.game.sound.play(a)},Phaser.Button.prototype.goUp=function(a){this.frame=0,this.text.y-=3,this.game.soundOn&&a&&this.game.sound.play(a)},A.createHitButton=function(a,b){var c=this.add.button(a,b,"hitButton",A.treasures.hit);return c.anchor.setTo(.5,.5),c.fixedToCamera=!0,c.text=this.add.text(c.x,c.y,this.game.lang.hit_button,{font:this.game.textFont,fill:"#FBEFEF",fontSize:55}),c.text.anchor.setTo(.5,.5),c.text.fixedToCamera=!0,c.onInputDown.add(function(){c.text.fill="#FFFF00"}),c.onInputUp.add(function(){c.text.fill="#FBEFEF"}),c.alpha=.7,c},A.createJoystick=function(a,b,c){for(var d=["left","up","right","down"],e={},f=0;4>f;f++){var g=this.add.button(a-c,b,"joystick");g.anchor.setTo(.5,.5),g.position.rotate(a,b,Math.PI*f/2,!1,c),g.rotation=Math.PI*f/2,g.fixedToCamera=!0,g.inputEnabled=!0,g.onInputDown.add(function(){this.isDown=!0},g),g.onInputOver.add(o,g,g),g.onInputUp.add(function(){this.isDown=!1},g),g.onInputOut.add(function(){this.isDown=!1},g),g.alpha=.7,e[d[f]]=g}return e.resetFrames=p,e},Phaser.Game.prototype.createBoard=function(a,b,c,d){var e=this.add.group();return e.buttons=this.add.group(),e.fixedToCamera=!0,e.visible=!1,e.panel=this.make.image(a,b,"panel"),e.panel.anchor.setTo(.5,.5),c&&(e.panel.height=c),d&&(e.panel.width=d),e.label=this.make.image(a,e.panel.top,"level_label"),e.label.anchor.setTo(.5),e.label.text=this.make.text(e.label.x,e.label.y,"",{font:this.textFont,fill:"#E86A17",fontSize:80}),e.label.text.anchor.setTo(.5),e.setTitle=q,e.addMultiple([e.panel,e.label,e.label.text]),e},A.createTimer=function(){var a=this.time.create(!1);return a.left=this.level.time,a.updateTime=r,a.timeLeftEvent=a.loop(1e3,a.updateTime.bind(a)),a};var B=15;Phaser.Group.prototype.createSubGroup=function(){for(var a=new Phaser.Group(this.game,null);this.length>0;)a.add(this.children[0]);return this.add(a),a},Phaser.Game.prototype.setPause=function(a,b,c,d){var e;if(a)for(e=0;e<a.length;e++)a[e].exists=!1;if(b)for(e=0;e<b.length;e++)b[e].pause();if(c)for(e=0;e<c.length;e++)c[e].inputEnabled=!1;d&&(this.input.keyboard.enabled=!1,this.input.reset(!1))},Phaser.Game.prototype.unsetPause=function(a,b,c,d){var e;if(a)for(e=0;e<a.length;e++)a[e].exists=!0;if(b)for(e=0;e<b.length;e++)b[e].resume();if(c)for(e=0;e<c.length;e++)c[e].inputEnabled=!0;d&&(this.input.keyboard.enabled=!0)};var C={up:0,down:1,right:2,left:3};Phaser.Game.prototype.playsound=function(a){this.soundOn&&this.sound.play(a)};var D;window.onload=function(){D=new Phaser.Game(1200,750,Phaser.AUTO,"game"),D.state.add("Boot",w),D.state.add("Load",x),D.state.add("Menu",y),D.state.add("Play-intro",z),D.state.add("Play",A),D.state.start("Boot")}}();